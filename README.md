# Sych Bot (Сыч)

Это не очередной «полезный ассистент» для погоды и курсов валют. Это полноценный участник чата с характером, памятью и собственным мнением.

Бот работает на базе **Google Gemini**, умеет видеть, слышать и запоминать контекст. Основная фишка — он мимикрирует под стиль общения в чате и ведет динамическое досье на каждого пользователя.

## Возможности

### Память и Репутация
Сыч помнит, о чем вы говорили 5 минут назад. Но главное — он помнит, как вы к нему относитесь.
*   **Система репутации:** Если вы грубите боту, он понижает ваш скрытый рейтинг и начинает отвечать токсично. Если хвалите — становится лояльнее.
*   **Досье:** Бот формирует психологический портрет участников. Он запоминает имена, факты и локальные мемы, сохраняя их в JSON.

### Распознавание голосовых (Voice-to-Text)
Потому что слушать 3-минутные голосовые в 2025 году — это моветон.
*   Бот автоматически сразу же переводит голосовые сообщения в текст.
*   **Умное саммари:** Если голосовое длинное, а сути мало, бот выдаст краткую выжимку (TL;DR). Если текст и так короткий — просто расшифровку.

### Мультимодальность
*   **Зрение:** Кидайте фото, скриншоты или документы — бот понимает, что на них изображено.
*   **Видео:** Поддерживает анализ видеофайлов (до 20 МБ).

### Управление вниманием
Бот не лезет в каждый разговор, если его не просят.
*   **Режим наблюдателя:** Он читает чат, копит контекст, но отвечает только при триггерах (имя "Сыч", реплай) или если решит, что его шутка будет *действительно* уместна (вероятность 1%).
*   **Точечный мьют:** Поддержка топиков (Threads) в Telegram. Можно заткнуть бота в одном топике, а в другом он продолжит общаться. Команда `/mute`.

### Обход лимитов (Key Rotation)
Google Gemini имеет жесткие лимиты на частоту запросов (RPM).
В боте реализована система ротации API-ключей. Если один ключ ловит ошибку `429 Too Many Requests`, бот мгновенно переключается на следующий из пула.

---

## Установка и запуск

Требуется **Node.js 18+**.

### 1. Клонирование
```bash
git clone https://github.com/Veta-one/sych-bot.git
cd sych-bot
npm install
```

### 2. Конфигурация
Создайте файл `.env` в корне проекта. В проекте нет базы данных типа Mongo или Postgres, всё хранится в локальных JSON-файлах, так что настраивать докеры не придется.

Пример `.env`:
```ini
# Токен от @BotFather
TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11

# Ваш ID (чтобы бот слал вам логи и ошибки в личку)
ADMIN_USER_ID=123456789

# Публичный HTTPS-домен, доступный для Telegram (без слеша в конце)
WEBHOOK_BASE_URL=https://your-domain.example

# Порт локального HTTP-сервера для приёма вебхуков
PORT=3000

# Ключи Google Gemini (получить в Google AI Studio)
# Можно указать один, а можно хоть десять для ротации
GOOGLE_GEMINI_API_KEY=AIzaSyD...
GOOGLE_GEMINI_API_KEY_2=AIzaSyD...
GOOGLE_GEMINI_API_KEY_3=AIzaSyD...
```

> Бот работает через вебхуки. Убедитесь, что `WEBHOOK_BASE_URL` указывает на публичный HTTPS-домен, до которого Telegram может достучаться.

### 3. Запуск

**Локально (для тестов):**
```bash
npm start
```

**На сервере (Production):**
Рекомендуется использовать PM2 для автоперезапуска при падениях.
```bash
npm install -g pm2
pm2 start index.js --name "sych-bot"
pm2 save
```

---

## Команды

Бот понимает естественный язык, но есть и хардкод-команды:

*   `/start` или `/help` — Вывод справки.
*   `/mute` — Переключить режим тишины в текущем чате или топике.
*   `/reset` — Сброс контекста диалога (если бота занесло или он начал бредить).
*   **Триггеры в тексте:**
    *   `Сыч напомни [текст]` — поставит напоминание (понимает контекст, например "напомни *об этом* завтра").
    *   `Сыч кто я?` — выдаст всё, что думает о вас, опираясь на накопленное досье.
    *   `Сыч кинь монетку` / `рандом` — развлекательные функции.

---

## Структура проекта

*   `/core` — Логика поведения (`logic.js`) и промпты (`prompts.js`).
*   `/services` — Работа с API (`ai.js`) и файловой системой (`storage.js`).
*   `/data` — Сюда бот сохраняет `db.json` (настройки чатов) и `profiles.json` (досье юзеров). **Эту папку лучше добавить в .gitignore, если не хотите слить переписки.**

---

## Связь

Если хочешь следить за обновлениями, выкладками и экспериментами — заходи в мой Telegram-канал:

**https://t.me/VETA14**

---

## Поддержать проект

Если проект зашёл/помог/понравился — буду рад любому донату

**USDT (TRC20):** `TYgsAvTkkrRqArgo3Q5BYMghbYn6DViVqQ`

---